
<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Hausaufgaben ‚Äì Sch√ºler:innen-√úbersicht</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: Arial, sans-serif; background: #E6F5FF; margin: 0; padding: 0; }
    .header { background: #0078D4; color: white; padding: 1em; text-align: center; font-size: 1.25rem; }
    .container { max-width: 700px; margin: 1em auto; background: white; padding: 1em; border-radius: 8px; }
    .task-form { display: flex; flex-wrap: wrap; gap: 0.5em; margin-bottom: 1em; }
    .task-form select, .task-form input[type="text"], .task-form input[type="date"], .task-form textarea {
      flex: 1 1 calc(33% - 0.5em); padding: 0.5em; font-size: 1rem; box-sizing: border-box;
    }
    .task-form textarea { flex: 1 1 100%; height: 80px; }
    .file-label { flex: 1 1 calc(70% - 0.5em); display: flex; align-items: center; padding: 0.5em; background: #F8FBFF;
      border: 1px solid #CBD4E1; border-radius: 4px; cursor: pointer; }
    .file-label input { display: none; }
    .file-label .icon { font-size: 1rem; }
    .file-label span { margin-left: 0.5em; font-size: 0.9rem; }
    .task-form button { flex: 1 1 calc(30% - 0.5em); background: #0078D4; color: white; border: none;
      padding: 0.75em; font-size: 1rem; border-radius: 4px; cursor: pointer; }
  </style>
</head>
<body>
  <div class="header">Hausaufgaben√ºbersicht</div>
  <div class="container">
    <form class="task-form" id="task-form">
      <select id="task-subject" required>
        <option value="">Fach w√§hlen</option>
        <option>Deutsch</option><option>Mathematik</option><option>Englisch</option>
      </select>
      <input type="text" id="task-title" placeholder="Titel" required>
      <input type="date" id="task-date" required>
      <textarea id="task-desc" placeholder="Beschreibung (optional)"></textarea>
      <label class="file-label">
        <span class="icon">üìé</span>
        <span id="file-names">Datei/Foto ausw√§hlen</span>
        <input type="file" id="task-attachments" multiple>
      </label>
      <button type="submit">Hinzuf√ºgen</button>
    </form>
    <ul class="task-list" id="task-list"></ul>
  </div>
  <script>
    const STORAGE_KEY = 'hausaufgaben_entries';
    const fileMap = {};

    async function loadEntries() {
      const raw = localStorage.getItem(STORAGE_KEY);
      return raw ? JSON.parse(raw) : [];
    }

    async function saveEntryToStorage(fn, entry) {
      if (entry.attachments && entry.attachments.length) {
        entry.fileData = entry.fileData || {};
        entry.attachments.forEach(name => {
          if (fileMap[name]) entry.fileData[name] = fileMap[name];
        });
      }

      const list = await loadEntries();
      const i = list.findIndex(e => e.filename === fn);
      if (i >= 0) list[i].entry = entry;
      else list.push({ filename: fn, entry });
      localStorage.setItem(STORAGE_KEY, JSON.stringify(list));
    }

    const form = document.getElementById('task-form');
    const subjI = document.getElementById('task-subject');
    const titleI = document.getElementById('task-title');
    const dateI = document.getElementById('task-date');
    const descI = document.getElementById('task-desc');
    const attachI = document.getElementById('task-attachments');
    const fileNames = document.getElementById('file-names');

    attachI.addEventListener('change', () => {
      const files = Array.from(attachI.files);
      fileNames.textContent = files.map(f => f.name).join(', ');
      files.forEach(f => {
        const reader = new FileReader();
        reader.onload = e => fileMap[f.name] = e.target.result;
        reader.readAsDataURL(f);
      });
    });

    form.addEventListener('submit', async e => {
      e.preventDefault();
      const subject = subjI.value;
      const title = titleI.value.trim();
      const date = dateI.value;
      const description = descI.value.trim();
      const attachments = Array.from(attachI.files).map(f => f.name);

      if (!subject || !title || !date) return;

      const entry = {
        date, subject, title, description, done: false, attachments, origin: 'student'
      };

      const fn = `${date}_${subject}_${title.replace(/\s+/g, '_')}.json`;
      await saveEntryToStorage(fn, entry);
      form.reset();
      fileNames.textContent = 'Datei/Foto ausw√§hlen';
    });
</script>
<!-- Service Worker-Registrierung MUSS hier stehen, vor </body> -->
<script>
  if ('serviceWorker' in navigator) {
    console.log('Registriere Service Worker‚Ä¶');
    navigator.serviceWorker.register('./service-worker.js')
      .then(reg => console.log('Service Worker registriert mit Scope:', reg.scope))
      .catch(err => console.error('Service Worker konnte nicht registriert werden:', err));
  }
</script>
</body>
</html>
